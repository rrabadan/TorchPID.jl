<!DOCTYPE html>
<html lang="en"><head><meta charset="UTF-8"/><meta name="viewport" content="width=device-width, initial-scale=1.0"/><title>Photon Mapper · TorchPID.jl</title><script data-outdated-warner src="../../assets/warner.js"></script><link rel="canonical" href="https://rrabadan.github.io/TorchPID.jl/api/photonmapper/"/><link href="https://cdnjs.cloudflare.com/ajax/libs/lato-font/3.0.0/css/lato-font.min.css" rel="stylesheet" type="text/css"/><link href="https://cdnjs.cloudflare.com/ajax/libs/juliamono/0.045/juliamono.min.css" rel="stylesheet" type="text/css"/><link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.15.4/css/fontawesome.min.css" rel="stylesheet" type="text/css"/><link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.15.4/css/solid.min.css" rel="stylesheet" type="text/css"/><link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.15.4/css/brands.min.css" rel="stylesheet" type="text/css"/><link href="https://cdnjs.cloudflare.com/ajax/libs/KaTeX/0.13.24/katex.min.css" rel="stylesheet" type="text/css"/><script>documenterBaseURL="../.."</script><script src="https://cdnjs.cloudflare.com/ajax/libs/require.js/2.3.6/require.min.js" data-main="../../assets/documenter.js"></script><script src="../../siteinfo.js"></script><script src="../../../versions.js"></script><link class="docs-theme-link" rel="stylesheet" type="text/css" href="../../assets/themes/documenter-dark.css" data-theme-name="documenter-dark" data-theme-primary-dark/><link class="docs-theme-link" rel="stylesheet" type="text/css" href="../../assets/themes/documenter-light.css" data-theme-name="documenter-light" data-theme-primary/><script src="../../assets/themeswap.js"></script><link href="../../assets/custom.css" rel="stylesheet" type="text/css"/></head><body><div id="documenter"><nav class="docs-sidebar"><div class="docs-package-name"><span class="docs-autofit"><a href="../../">TorchPID.jl</a></span></div><form class="docs-search" action="../../search/"><input class="docs-search-query" id="documenter-search-query" name="q" type="text" placeholder="Search docs"/></form><ul class="docs-menu"><li><a class="tocitem" href="../../">Home</a></li><li><a class="tocitem" href="../../torch/">TORCH Detector</a></li><li><a class="tocitem" href="../../guide/">Guide</a></li><li><span class="tocitem">API</span><ul><li><a class="tocitem" href="../api/">Overview</a></li><li><a class="tocitem" href="../physics_constants/">Physics Constants</a></li><li><a class="tocitem" href="../hit_models/">Hit Models</a></li><li><a class="tocitem" href="../photon/">Photon</a></li><li class="is-active"><a class="tocitem" href>Photon Mapper</a></li><li><a class="tocitem" href="../photonspectrum/">Photon Spectrum</a></li><li><a class="tocitem" href="../pattern_matcher/">Pattern Matcher</a></li></ul></li></ul><div class="docs-version-selector field has-addons"><div class="control"><span class="docs-label button is-static is-size-7">Version</span></div><div class="docs-selector control is-expanded"><div class="select is-fullwidth is-size-7"><select id="documenter-version-selector"></select></div></div></div></nav><div class="docs-main"><header class="docs-navbar"><nav class="breadcrumb"><ul class="is-hidden-mobile"><li><a class="is-disabled">API</a></li><li class="is-active"><a href>Photon Mapper</a></li></ul><ul class="is-hidden-tablet"><li class="is-active"><a href>Photon Mapper</a></li></ul></nav><div class="docs-right"><a class="docs-edit-link" href="https://github.com/rrabadan/TorchPID.jl/blob/main/docs/src/api/photonmapper.md" title="Edit on GitHub"><span class="docs-icon fab"></span><span class="docs-label is-hidden-touch">Edit on GitHub</span></a><a class="docs-settings-button fas fa-cog" id="documenter-settings-button" href="#" title="Settings"></a><a class="docs-sidebar-button fa fa-bars is-hidden-desktop" id="documenter-sidebar-button" href="#"></a></div></header><article class="content" id="documenter-page"><h1 id="PhotonMapper-API"><a class="docs-heading-anchor" href="#PhotonMapper-API">PhotonMapper API</a><a id="PhotonMapper-API-1"></a><a class="docs-heading-anchor-permalink" href="#PhotonMapper-API" title="Permalink"></a></h1><p>Tools for simulating the photon propagation through TORCH&#39;s optical system.</p><h3 id="Public-API"><a class="docs-heading-anchor" href="#Public-API">Public API</a><a id="Public-API-1"></a><a class="docs-heading-anchor-permalink" href="#Public-API" title="Permalink"></a></h3><article class="docstring"><header><a class="docstring-binding" id="TorchPID.PhotonMapper" href="#TorchPID.PhotonMapper"><code>TorchPID.PhotonMapper</code></a> — <span class="docstring-category">Type</span></header><section><div><pre><code class="language-julia hljs">PhotonMapper(blackened_sides blackened_bottom,
             blackened, surface_roughness,
             max_x_reflections)</code></pre><p>Type representing the photon mapping configuration for photon propagation.</p><p><strong>Fields</strong></p><ul><li><code>blackened_sides::Bool</code>: If true, photons reflecting off the radiator&#39;s sides are absorbed.</li><li><code>blackened_bottom::Bool</code>: If true, photons reflecting off the radiator&#39;s bottom are ignored.</li><li><code>blackened_focus::Bool</code>: If true, reflections in the focus region are handled differently.</li><li><code>surface_roughness::Bool</code>: If true, surface imperfections of the radiator are considered.</li><li><code>max_x_reflections::INt</code>: Specifies the maximum allowable x-direction reflections before the photon is discarded.</li></ul><p><strong>Constructors</strong></p><pre><code class="nohighlight hljs">PhotonMapper(; 
    blackened_sides::Bool=false,
    blackened_bottom::Bool=false,
    blackened_focus::Bool=false,
    surface_roughness::Bool=false,
    max_x_reflections::Int=10
)</code></pre><p><strong>Keywords</strong></p><ul><li><code>blackened_sides::Bool=false</code>: Enable absorption of side reflections.</li><li><code>blackened_bottom::Bool=false</code>: Ignore bottom reflections if true.</li><li><code>blackened_focus::Bool=false</code>: Handle focus region reflections differently.</li><li><code>surface_roughness::Bool=false</code>: Account for surface imperfections.</li><li><code>max_x_reflections::Int=10</code>: Maximum number of x-direction reflections allowed.</li></ul><p><strong>Returns</strong></p><ul><li><code>PhotonMapper</code>: A new PhotonMapper instance with the specified configuration.</li></ul></div><a class="docs-sourcelink" target="_blank" href="https://github.com/rrabadan/TorchPID.jl/blob/5f20ea0e22a6826c96b767257621959b44c97e4a/src/PhotonMapper.jl#L1-L34">source</a></section></article><article class="docstring"><header><a class="docstring-binding" id="TorchPID.trace_photon-Tuple{PhotonMapper, Photon, Float64}" href="#TorchPID.trace_photon-Tuple{PhotonMapper, Photon, Float64}"><code>TorchPID.trace_photon</code></a> — <span class="docstring-category">Method</span></header><section><div><pre><code class="language-julia hljs">trace_photon(mapper::PhotonMapper, photon::Photon, t0::Float64)</code></pre><p><code>trace_photon</code> simulates the photon&#39;s journey through the optical system, from emission to detection.  It propagates the photon to the top of the plate, accounting for y-direction and z-direction reflections, surface roughness, and pathlength accumulation. It then traces the photon to the focus block, simulating its interaction with the focusing optics, and finally to the detector plane, where it checks for acceptance criteria. The function returns the detected hit coordinate if the photon is successfully traced, or <code>nothing</code> if any tracing step fails.</p><p><strong>Arguments</strong></p><ul><li><code>mapper::PhotonMapper</code>: The photon mapping configuration.</li><li><code>photon::Photon</code>: The photon to trace.</li><li><code>t0::Float64</code>: The production time of the photon.</li></ul><p><strong>Returns</strong></p><ul><li><code>Union{HitCoordinate,Nothing}</code>: The detected hit coordinate if the photon is successfully traced, or <code>nothing</code> if any tracing step fails.</li></ul></div><a class="docs-sourcelink" target="_blank" href="https://github.com/rrabadan/TorchPID.jl/blob/5f20ea0e22a6826c96b767257621959b44c97e4a/src/PhotonMapper.jl#L59-L75">source</a></section></article><h3 id="Implementation-Details"><a class="docs-heading-anchor" href="#Implementation-Details">Implementation Details</a><a id="Implementation-Details-1"></a><a class="docs-heading-anchor-permalink" href="#Implementation-Details" title="Permalink"></a></h3><p>The <code>trace_photon</code> function internally uses helper functions to propagate the cherenkov emitted photon.</p><p>These internal functions are not part of the public API and may change without notice.</p><article class="docstring"><header><a class="docstring-binding" id="TorchPID._project_x_detector_position-Tuple{PhotonMapper, Photon, Float64}" href="#TorchPID._project_x_detector_position-Tuple{PhotonMapper, Photon, Float64}"><code>TorchPID._project_x_detector_position</code></a> — <span class="docstring-category">Method</span></header><section><div><pre><code class="language-julia hljs">_project_x_detector_position(mapper::PhotonMapper, photon::Photon, pathlength::Float64)</code></pre><p><code>_project_x_detector_position</code> calculates the photon&#39;s x-coordinate on the detector plane by projecting its trajectory. It considers x-direction reflections based on the mapper&#39;s configuration. Returns <code>nothing</code> if side blackening is enabled and reflection is required, the photon cannot reflect in x, or the maximum allowed reflections is exceeded.</p><p><strong>Arguments</strong></p><ul><li><code>mapper::PhotonMapper</code>: The mapping configuration.</li><li><code>photon::Photon</code>: The photon instance.</li><li><code>pathlength::Float64</code>: Total travelled pathlength.</li></ul><p><strong>Returns</strong></p><ul><li><code>Union{Float64,Nothing}</code>: The projected x position on the detector, or <code>nothing</code> if the photon does not reach the detector due to reflection conditions.</li></ul></div><a class="docs-sourcelink" target="_blank" href="https://github.com/rrabadan/TorchPID.jl/blob/5f20ea0e22a6826c96b767257621959b44c97e4a/src/PhotonMapper.jl#L329-L344">source</a></section></article><article class="docstring"><header><a class="docstring-binding" id="TorchPID._trace_to_detector-Tuple{Float64, Float64, Float64}" href="#TorchPID._trace_to_detector-Tuple{Float64, Float64, Float64}"><code>TorchPID._trace_to_detector</code></a> — <span class="docstring-category">Method</span></header><section><div><pre><code class="language-julia hljs">_trace_to_detector(yf::Float64, tyf::Float64, tzf::Float64)</code></pre><p><code>_trace_to_detector</code> simulates the photon&#39;s propagation from the entrance of the focusing block to the detector plane, accounting for mirror reflections and acceptance criteria.</p><p><strong>Arguments</strong></p><ul><li><code>yf::Float64</code>: Position at entrance of the focus block</li><li><code>tyf::Float64</code>: Y-component of photon momentum at entrance of the focus block</li><li><code>tzf::Float64</code>: Z-component of photon momentum at entrance of the focus block</li></ul><p><strong>Returns</strong></p><ul><li><code>Union{Tuple{Float64,Float64},Nothing}</code>: A tuple containing:<ul><li><code>ydetected::Float64</code>: Position of photon on detector plane</li><li><code>pathlength::Float64</code>: Accumulated pathlength</li></ul>Returns <code>nothing</code> if the photon&#39;s path is terminated.</li></ul></div><a class="docs-sourcelink" target="_blank" href="https://github.com/rrabadan/TorchPID.jl/blob/5f20ea0e22a6826c96b767257621959b44c97e4a/src/PhotonMapper.jl#L240-L257">source</a></section></article><article class="docstring"><header><a class="docstring-binding" id="TorchPID._trace_to_focus-Tuple{Float64, Float64, Float64}" href="#TorchPID._trace_to_focus-Tuple{Float64, Float64, Float64}"><code>TorchPID._trace_to_focus</code></a> — <span class="docstring-category">Method</span></header><section><div><pre><code class="language-julia hljs">_trace_to_focus(zp::Float64, typ::Float64, tzp::Float64)</code></pre><p><code>_trace_to_focus</code> propagates the photon from the top of the flat section to the entrance of the focus block.</p><p><strong>Arguments</strong></p><ul><li><code>zp::Float64</code>: Position at top of the plate</li><li><code>typ::Float64</code>: Y-component of photon momentum at top of the plate</li><li><code>tzp::Float64</code>: Z-component of photon momentum at top of the plate</li></ul><p><strong>Returns</strong></p><ul><li><code>Union{Tuple{Float64,Float64,Float64,Float64},Nothing}</code>: A tuple containing:<ul><li><code>yf::Float64</code>: Position in focus block coordinates</li><li><code>tyf::Float64</code>: Y-component of photon momentum in focus block coordinates</li><li><code>tzf::Float64</code>: Z-component of photon momentum in focus block coordinates</li><li><code>pathlength::Float64</code>: Accumulated pathlength</li></ul>Returns <code>nothing</code> if the photon&#39;s path is terminated.</li></ul></div><a class="docs-sourcelink" target="_blank" href="https://github.com/rrabadan/TorchPID.jl/blob/5f20ea0e22a6826c96b767257621959b44c97e4a/src/PhotonMapper.jl#L195-L213">source</a></section></article><article class="docstring"><header><a class="docstring-binding" id="TorchPID._trace_to_top_of_plate-Tuple{PhotonMapper, Photon}" href="#TorchPID._trace_to_top_of_plate-Tuple{PhotonMapper, Photon}"><code>TorchPID._trace_to_top_of_plate</code></a> — <span class="docstring-category">Method</span></header><section><div><pre><code class="language-julia hljs">_trace_to_top_of_plate(mapper::PhotonMapper, photon::Photon)</code></pre><p><code>_trace_to_top_of_plate</code> propagates the photon to the top of the plate, accounting for y-direction and z-direction reflections, surface roughness, and pathlength accumulation.</p><p><strong>Arguments</strong></p><ul><li><code>mapper::PhotonMapper</code>: The mapping configuration.</li><li><code>photon::Photon</code>: The photon to be traced.</li></ul><p><strong>Returns</strong></p><ul><li><code>Union{Tuple{Float64,Float64,Float64,Float64},Nothing}</code>: A tuple containing:<ul><li><code>zp::Float64</code>: Position in z</li><li><code>typ::Float64</code>: Y-component of photon momentum</li><li><code>tzp::Float64</code>: Z-component of photon momentum</li><li><code>pathlength::Float64</code>: Accumulated pathlength</li></ul>Returns <code>nothing</code> if the photon&#39;s path is terminated.</li></ul></div><a class="docs-sourcelink" target="_blank" href="https://github.com/rrabadan/TorchPID.jl/blob/5f20ea0e22a6826c96b767257621959b44c97e4a/src/PhotonMapper.jl#L133-L150">source</a></section></article></article><nav class="docs-footer"><a class="docs-footer-prevpage" href="../photon/">« Photon</a><a class="docs-footer-nextpage" href="../photonspectrum/">Photon Spectrum »</a><div class="flexbox-break"></div><p class="footer-message">Powered by <a href="https://github.com/JuliaDocs/Documenter.jl">Documenter.jl</a> and the <a href="https://julialang.org/">Julia Programming Language</a>.</p></nav></div><div class="modal" id="documenter-settings"><div class="modal-background"></div><div class="modal-card"><header class="modal-card-head"><p class="modal-card-title">Settings</p><button class="delete"></button></header><section class="modal-card-body"><p><label class="label">Theme</label><div class="select"><select id="documenter-themepicker"><option value="documenter-light">documenter-light</option><option value="documenter-dark">documenter-dark</option></select></div></p><hr/><p>This document was generated with <a href="https://github.com/JuliaDocs/Documenter.jl">Documenter.jl</a> version 0.27.25 on <span class="colophon-date" title="Sunday 10 August 2025 18:02">Sunday 10 August 2025</span>. Using Julia version 1.11.6.</p></section><footer class="modal-card-foot"></footer></div></div></div></body></html>
